# NGINX Configuration Fix for Heiraza Website
# Location: Usually /etc/nginx/sites-available/your-site or /etc/nginx/nginx.conf

# The 413 "Request Entity Too Large" error occurs because nginx's default
# client_max_body_size is only 1MB or 2MB.

# ===================================================
# OPTION 1: Add to your server block (RECOMMENDED)
# ===================================================
# Edit your site's nginx configuration file:
# sudo nano /etc/nginx/sites-available/default
# (or your specific site config file)

server {
    listen 80;
    listen [::]:80;
    server_name test.heiraza.com www.test.heiraza.com heiraza.com www.heiraza.com;
    
    # IMPORTANT: Increase max body size for file uploads (audio tracks, images)
    # Set to 100MB to allow large audio files
    client_max_body_size 100M;
    
    # Your existing location blocks...
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        
        # Also increase proxy buffer sizes for large uploads
        proxy_buffer_size 128k;
        proxy_buffers 4 256k;
        proxy_busy_buffers_size 256k;
        
        # Increase timeout for large file uploads
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
    }
}

# ===================================================
# OPTION 2: Add to http block for global setting
# ===================================================
# If you want this to apply to ALL sites on the server:
# Edit: sudo nano /etc/nginx/nginx.conf
# Add inside the http { } block:
#
#     client_max_body_size 100M;
#

# ===================================================
# AFTER MAKING CHANGES:
# ===================================================
# 1. Test nginx configuration:
#    sudo nginx -t
#
# 2. If test passes, reload nginx:
#    sudo systemctl reload nginx
#    OR
#    sudo nginx -s reload
#
# 3. Verify the change took effect by trying an upload again
